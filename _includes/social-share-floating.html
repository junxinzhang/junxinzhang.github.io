<!-- Social Share Floating Buttons - Increase social traffic -->
<div class="social-share-floating" id="socialShareFloating">
    <div class="share-label" data-i18n="share.share">Share</div>

    <!-- Twitter/X -->
    <a href="https://twitter.com/intent/tweet?url={{ page.url | absolute_url | url_encode }}&text={{ page.title | url_encode }}&via={{ site.twitter.username }}"
       class="share-btn share-twitter"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on X (Twitter)"
       aria-label="Share on X">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
            <path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865l8.875 11.633Z"/>
        </svg>
    </a>

    <!-- LinkedIn -->
    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ page.url | absolute_url | url_encode }}"
       class="share-btn share-linkedin"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on LinkedIn"
       aria-label="Share on LinkedIn">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
            <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/>
        </svg>
    </a>

    <!-- Facebook -->
    <a href="https://www.facebook.com/sharer/sharer.php?u={{ page.url | absolute_url | url_encode }}"
       class="share-btn share-facebook"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on Facebook"
       aria-label="Share on Facebook">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
            <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
        </svg>
    </a>

    <!-- WeChat (QR Code trigger) -->
    <button class="share-btn share-wechat"
            id="wechatShareBtn"
            title="Share on WeChat"
            aria-label="Share on WeChat">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
            <path d="M11.176 14.429c-2.665 0-4.826-1.8-4.826-4.018 0-2.22 2.159-4.02 4.824-4.02S16 8.191 16 10.411c0 1.21-.65 2.301-1.666 3.036a.324.324 0 0 0-.12.366l.218.81a.616.616 0 0 1 .029.117.166.166 0 0 1-.162.162.177.177 0 0 1-.092-.03l-1.057-.61a.519.519 0 0 0-.256-.074.509.509 0 0 0-.142.021 5.668 5.668 0 0 1-1.576.22ZM9.064 9.542a.647.647 0 1 0 .557-1 .645.645 0 0 0-.646.647.615.615 0 0 0 .09.353Zm3.232.001a.646.646 0 1 0 .546-1 .645.645 0 0 0-.644.644.627.627 0 0 0 .098.356Z"/>
            <path d="M0 6.826c0 1.455.781 2.765 2.001 3.656a.385.385 0 0 1 .143.439l-.161.6-.1.373a.499.499 0 0 0-.032.14.192.192 0 0 0 .193.193c.039 0 .077-.01.111-.029l1.268-.733a.622.622 0 0 1 .308-.088c.058 0 .116.009.171.025a6.83 6.83 0 0 0 1.625.26 4.45 4.45 0 0 1-.177-1.251c0-2.936 2.785-5.02 5.824-5.02.05 0 .1 0 .15.002C10.587 3.429 8.392 2 5.796 2 2.596 2 0 4.16 0 6.826Zm4.632-1.555a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0Zm3.875 0a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0Z"/>
        </svg>
    </button>

    <!-- Copy Link -->
    <button class="share-btn share-copy"
            id="copyLinkBtn"
            title="Copy Link"
            aria-label="Copy article link">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16" id="copyIcon">
            <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
            <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16" id="checkIcon" style="display:none;">
            <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
        </svg>
    </button>
</div>

<!-- WeChat QR Code Modal -->
<div class="wechat-qr-modal" id="wechatQrModal">
    <div class="wechat-qr-content">
        <button class="wechat-qr-close" id="wechatQrClose" aria-label="Close">&times;</button>
        <h4 data-i18n="share.scan_wechat">Scan to share on WeChat</h4>
        <div class="wechat-qr-code" id="wechatQrCode"></div>
        <p class="text-muted small" data-i18n="share.wechat_tip">Open WeChat and scan</p>
    </div>
</div>

<style>
/* Floating Share Buttons */
.social-share-floating {
    position: fixed;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 8px;
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.social-share-floating.visible {
    opacity: 1;
    visibility: visible;
}

.social-share-floating .share-label {
    font-size: 11px;
    color: var(--text-muted, #6c757d);
    text-transform: uppercase;
    letter-spacing: 1px;
    text-align: center;
    margin-bottom: 4px;
}

.share-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    text-decoration: none;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: none;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.share-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    color: #fff;
    text-decoration: none;
}

.share-twitter { background: #000; }
.share-linkedin { background: #0077b5; }
.share-facebook { background: #1877f2; }
.share-wechat { background: #07c160; }
.share-copy { background: #6c757d; }
.share-copy.copied { background: #28a745; }

/* Dark mode styles */
[data-theme="dark"] .social-share-floating .share-label {
    color: #8b949e;
}

[data-theme="dark"] .share-btn {
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
}

/* Hide on mobile - use bottom sheet instead */
@media (max-width: 1200px) {
    .social-share-floating {
        display: none !important;
    }
}

/* WeChat QR Modal */
.wechat-qr-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.wechat-qr-modal.show {
    display: flex;
}

.wechat-qr-content {
    background: var(--card-bg, #fff);
    padding: 30px;
    border-radius: 12px;
    text-align: center;
    position: relative;
    max-width: 300px;
}

.wechat-qr-close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--text-muted, #6c757d);
}

.wechat-qr-code {
    width: 200px;
    height: 200px;
    margin: 20px auto;
    background: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.wechat-qr-code canvas {
    max-width: 100%;
}

[data-theme="dark"] .wechat-qr-content {
    background: #1e293b;
    color: #e4e4e7;
}
</style>

<script>
(function() {
    'use strict';

    var floatingShare = document.getElementById('socialShareFloating');
    if (!floatingShare) return;

    // Show/hide based on scroll position
    var scrollThrottle = false;
    window.addEventListener('scroll', function() {
        if (scrollThrottle) return;
        scrollThrottle = true;

        requestAnimationFrame(function() {
            if (window.scrollY > 300) {
                floatingShare.classList.add('visible');
            } else {
                floatingShare.classList.remove('visible');
            }
            scrollThrottle = false;
        });
    }, {passive: true});

    // Copy link functionality
    var copyBtn = document.getElementById('copyLinkBtn');
    var copyIcon = document.getElementById('copyIcon');
    var checkIcon = document.getElementById('checkIcon');

    if (copyBtn) {
        copyBtn.addEventListener('click', function() {
            var url = window.location.href;

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url).then(function() {
                    showCopied();
                }).catch(function() {
                    fallbackCopy(url);
                });
            } else {
                fallbackCopy(url);
            }
        });
    }

    function fallbackCopy(text) {
        var textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand('copy');
            showCopied();
        } catch (err) {
            console.error('Copy failed:', err);
        }
        document.body.removeChild(textarea);
    }

    function showCopied() {
        copyBtn.classList.add('copied');
        copyIcon.style.display = 'none';
        checkIcon.style.display = 'block';

        setTimeout(function() {
            copyBtn.classList.remove('copied');
            copyIcon.style.display = 'block';
            checkIcon.style.display = 'none';
        }, 2000);

        // Track in GA4
        if (typeof gtag === 'function') {
            gtag('event', 'share', {
                method: 'copy_link',
                content_type: 'article',
                item_id: window.location.pathname
            });
        }
    }

    // WeChat QR Code Modal
    var wechatBtn = document.getElementById('wechatShareBtn');
    var wechatModal = document.getElementById('wechatQrModal');
    var wechatClose = document.getElementById('wechatQrClose');
    var wechatQrCode = document.getElementById('wechatQrCode');

    if (wechatBtn && wechatModal) {
        wechatBtn.addEventListener('click', function() {
            wechatModal.classList.add('show');

            // Generate QR code (using simple text-based approach)
            if (!wechatQrCode.hasChildNodes()) {
                // Load QRCode library dynamically
                var script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js';
                script.onload = function() {
                    new QRCode(wechatQrCode, {
                        text: window.location.href,
                        width: 180,
                        height: 180,
                        colorDark: '#000000',
                        colorLight: '#ffffff',
                        correctLevel: QRCode.CorrectLevel.M
                    });
                };
                document.head.appendChild(script);
            }

            // Track in GA4
            if (typeof gtag === 'function') {
                gtag('event', 'share', {
                    method: 'wechat',
                    content_type: 'article',
                    item_id: window.location.pathname
                });
            }
        });

        wechatClose.addEventListener('click', function() {
            wechatModal.classList.remove('show');
        });

        wechatModal.addEventListener('click', function(e) {
            if (e.target === wechatModal) {
                wechatModal.classList.remove('show');
            }
        });
    }

    // Track all share clicks
    document.querySelectorAll('.share-btn[href]').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var platform = this.classList.contains('share-twitter') ? 'twitter' :
                          this.classList.contains('share-linkedin') ? 'linkedin' :
                          this.classList.contains('share-facebook') ? 'facebook' : 'other';

            if (typeof gtag === 'function') {
                gtag('event', 'share', {
                    method: platform,
                    content_type: 'article',
                    item_id: window.location.pathname
                });
            }
        });
    });
})();
</script>
